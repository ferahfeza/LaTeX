<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaTeX Örnekleri - AstroBlog Teması</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
        <!-- PDF.js (CDN) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card-hover-effect {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover-effect:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(113, 113, 222, 0.1), 0 10px 10px -5px rgba(113, 113, 222, 0.04);
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-100 min-h-screen flex flex-col">

    <!-- Navigasyon Barı -->
    <header class="sticky top-0 z-50 w-full backdrop-blur-md bg-slate-900/60 shadow-lg shadow-blue-500/10">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="flex items-center justify-between h-16">
                <!-- Logo/Başlık 
                <a href="#" class="text-2xl font-bold">
                    <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">LaTeX/TikZ Örnekleri</span>
                </a>-->
                
                <!-- Menü Linkleri -->
                <div class="hidden md:flex space-x-6">
                    <a href="latex_ornekler.html" class="font-semibold text-gray-200 hover:text-blue-400 transition-colors">Örnek Kodlar</a>
                    <a href="#" class="font-semibold text-gray-400 hover:text-blue-400 transition-colors">Hakkında</a>
                </div>
                
                <!-- Mobil Menü Butonu -->
                <div class="md:hidden">
                    <button class="text-gray-200 hover:text-blue-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Ana İçerik -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 flex-grow">

        <!-- Detay Görünümü -->
        <section id="sample-detail" class="mb-12 p-6 bg-slate-800 rounded-xl shadow-lg border border-slate-700">
            <div id="detail-content" class="text-gray-200">
                <p class="text-center text-gray-400">Yükleniyor...</p>
            </div>
            <script>
                // Fallback mock data (kullanıcı local olarak fetch çalıştıramazsa kullanılır)
                const mockSamples = [
                    { id: 1, title: "Küreden Silindir Çıkarma", description: "Küreden Silindir Çıkarma Çizimi.", category: "TikZ", tags: ["3D"], date: "2025-10-25" },
                    { id: 2, title: "Yeni Komut Tanımlama", description: "Yeni komutları nasıl tanımlarız?", category: "LaTeX", tags: [], date: "2025-10-25" },
                    { id: 3, title: "Coulomb Kanunu", description: "Coulomb Kanunu Nedir?", category: "LaTeX", tags: [], date: "2025-10-23" },
                    { id: 4, title: "Türkçe Makale Örneği", description: "Türkçe Makale Örneği", category: "LaTeX", tags: ["Türkçe", "makale-sınıfı"], date: "2025-10-05" },
                    { id: 5, title: "Türkçe Kitap Örneği", description: "Türkçe Kitap Örneği", category: "LaTeX", tags: ["Türkçe", "kitap-sınıfı"], date: "2025-10-05" },
                    { id: 6, title: "Eşitliklerin Yazımı", description: "LaTeX ile Eşitliklerin Yazımı", category: "LaTeX", tags: ["matematik", "formüller"], date: "2025-10-05" },
                    { id: 7, title: "TikZ İle Perspektif", description: "TikZ ile perspektif çizim.", category: "TikZ", tags: ["3D", "perspektif"], date: "2025-09-22" },
                    { id: 8, title: "TikZ İle Türk Bayrağı Çizimi", description: "TikZ ile Türk Bayrağının çizimi.", category: "TikZ", tags: ["Türk Bayrağı"], date: "2025-09-09" }
                ];

                // Detay sayfasını başlatır: URL parametresinden `id` alır, JSON'dan veri yükler ve gösterir.
                async function initDetail() {
                    const params = new URLSearchParams(window.location.search);
                    const rawId = params.get('id');
                    const slugParam = params.get('slug');
                    const container = document.getElementById('detail-content');

                    if (!rawId && !slugParam) {
                        container.innerHTML = `<p class="text-center text-red-400">ID veya slug parametresi bulunamadı.</p>`;
                        return;
                    }

                    // JSON dosyasını yüklemeyi dene, başarısız olursa mockSamples kullan
                    let samples = null;
                    try {
                        const res = await fetch('data/samples.json');
                        if (res.ok) {
                            samples = await res.json();
                        } else {
                            samples = mockSamples;
                        }
                    } catch (e) {
                        // fetch file:// ile bloklanabilir; fallback kullan
                        samples = mockSamples;
                    }

                    // Bulma stratejisi:
                    // 1) Eğer slug param varsa slug ile eşleştir
                    // 2) Eğer id param sayısalsa, dizide index-1 kullan (fallback)
                    // 3) Eğer herhangi bir sample.id varsa ona göre eşleştir
                    let sample = null;
                    if (slugParam) {
                        sample = samples.find(s => String(s.slug) === String(slugParam));
                    }

                    if (!sample && rawId) {
                        // önce id alanı varsa ona göre ara
                        sample = samples.find(s => String(s.id) === String(rawId));
                    }

                    if (!sample && rawId && /^\d+$/.test(rawId)) {
                        const idx = parseInt(rawId, 10) - 1;
                        if (idx >= 0 && idx < samples.length) sample = samples[idx];
                    }

                    if (!sample) {
                        container.innerHTML = `<p class="text-center text-gray-400">Öğe bulunamadı (id/slug=${rawId || slugParam}).</p>`;
                        return;
                    }

                    // Normalize et: veri dosyanız `name` ve `createdAt` kullanıyor.
                    const normalized = {
                        id: sample.id ?? sample.slug ?? null,
                        title: sample.title ?? sample.name ?? sample.slug ?? 'Başlıksız',
                        description: sample.description ?? '',
                        category: sample.category ?? '',
                        tags: sample.tags ?? [],
                        date: sample.date ?? sample.createdAt ?? '',
                        texPath: sample.texPath ?? null,
                        pdfPath: sample.pdfPath ?? null
                    };

                    const tagsHtml = (normalized.tags || []).filter(Boolean).map(tag => `<span class="inline-block bg-slate-700 text-gray-300 rounded-full px-3 py-1 text-xs font-semibold mr-2">${tag}</span>`).join('');

                    // Determine if the file is an image (png/jpg/jpeg/tiff/gif)
                    const isImage = !!(normalized.pdfPath && /\.(png|jpe?g|tiff?|gif)$/i.test(normalized.pdfPath));

                    container.innerHTML = `
                        <article class="max-w-7xl mx-auto">
                            <header class="mb-6">
                                <h1 class="text-3xl md:text-4xl font-bold mb-2">${normalized.title}</h1>
                                <div class="flex items-center gap-3 mb-4">
                                    <span class="inline-block ${normalized.category && normalized.category.toLowerCase().includes('tikz') ? 'bg-purple-500/20 text-purple-300' : 'bg-blue-500/20 text-blue-300'} rounded-full px-3 py-1 text-sm font-semibold">${normalized.category}</span>
                                    <time class="text-sm text-gray-400">${normalized.date}</time>
                                </div>
                                <p class="text-gray-300 mb-4">${normalized.description}</p>
                                ${normalized.tags && normalized.tags.length ? `<div class="mb-4">${tagsHtml}</div>` : ''}
                            </header>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Sol: TeX kodu ve kopyala butonu -->
                                <div class="bg-slate-900 border border-slate-700 p-4 rounded">
                                    <div class="flex items-center justify-between mb-3">
                                        <h2 class="text-lg font-semibold">TeX Kaynağı</h2>
                                        <div class="flex items-center gap-2">
                                            ${normalized.texPath ? `<a id="download-tex" href="${normalized.texPath}" download class="text-sm bg-slate-700 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded">TeX İndir</a>` : ''}
                                            <button id="copy-tex" class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-1 px-3 rounded">Kopyala</button>
                                        </div>
                                    </div>
                                    <pre id="tex-code" class="whitespace-pre-wrap overflow-auto text-sm leading-6 p-3 bg-slate-800 rounded text-gray-100" style="max-height:720px;"></pre>
                                </div>

                                <!-- Sağ: PDF görüntüleyici -->
                                <div class="bg-slate-900 border border-slate-700 p-4 rounded flex flex-col">
                                    <div class="flex items-center justify-between mb-3">
                                        <h2 class="text-lg font-semibold">PDF Önizleme</h2>
                                        <div class="flex items-center gap-2">
                                            <button id="zoom-out" class="text-sm bg-slate-700 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded">-</button>
                                            <button id="zoom-reset" class="text-sm bg-slate-700 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded">%100</button>
                                            <button id="zoom-in" class="text-sm bg-slate-700 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded">+</button>
                                            <button id="fit-width" class="text-sm bg-slate-700 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded">Fit</button>
                                        </div>
                                    </div>
                                    <div class="flex-1 border border-slate-700 rounded overflow-hidden p-3 bg-slate-800">
                                                ${normalized.pdfPath ? (
                                                    isImage
                                                    ? `
                                                        <div id="image-viewer" class="w-full h-96 md:h-[720px] flex flex-col items-center justify-center overflow-auto" style="background:#111827;padding:8px;">
                                                            <img id="preview-img" src="${normalized.pdfPath}" alt="Görüntü" style="max-width:100%; height:auto; display:block; transform-origin:center center;" />
                                                        </div>
                                                    `
                                                    : `
                                                        <div id="pdf-viewer" class="w-full h-96 md:h-[720px] flex flex-col">
                                                            <div class="flex-1 overflow-auto" id="pdf-container" style="background:#111827;padding:8px;">
                                                                <canvas id="pdf-canvas" class="mx-auto block" style="background: #fff; display: block;"></canvas>
                                                            </div>
                                                            <div class="mt-2 flex items-center justify-between text-sm text-gray-300">
                                                                <div>Sayfa: <span id="page-num">0</span> / <span id="page-count">0</span></div>
                                                                <div class="flex items-center gap-2">
                                                                    <button id="page-prev" class="text-sm bg-slate-700 hover:bg-slate-600 text-white font-semibold py-0.5 px-2 rounded">◀</button>
                                                                    <input id="page-input" type="number" min="1" value="1" class="w-16 text-black text-sm p-1 rounded" />
                                                                    <button id="page-next" class="text-sm bg-slate-700 hover:bg-slate-600 text-white font-semibold py-0.5 px-2 rounded">▶</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    `
                                                ) : `<div class="p-6 text-center text-gray-400">PDF bulunamadı.</div>`}
                                            </div>
                                </div>
                            </div>
                        </article>
                    `;

                    // Sonrasında TeX dosyasını fetch edip içeriği göster
                    const texElem = document.getElementById('tex-code');
                    const copyBtn = document.getElementById('copy-tex');
                    if (normalized.texPath) {
                        try {
                            const resp = await fetch(normalized.texPath);
                            if (resp.ok) {
                                const texText = await resp.text();
                                // Güvenli şekilde ham metni yerleştir
                                texElem.textContent = texText;
                                copyBtn.addEventListener('click', async () => {
                                    try {
                                        await navigator.clipboard.writeText(texText);
                                        copyBtn.textContent = 'Kopyalandı';
                                        setTimeout(() => copyBtn.textContent = 'Kopyala', 1500);
                                    } catch (e) {
                                        alert('Kopyalama başarısız: ' + e.message);
                                    }
                                });
                            } else {
                                texElem.textContent = 'TeX dosyası yüklenemedi.';
                                copyBtn.disabled = true;
                            }
                        } catch (e) {
                            texElem.textContent = 'TeX dosyası yüklenemedi.';
                            copyBtn.disabled = true;
                        }
                    } else {
                        texElem.textContent = 'TeX kaynağı mevcut değil.';
                        copyBtn.disabled = true;
                    }

                    // PDF.js viewer initialization and controls
                    if (normalized.pdfPath && window.pdfjsLib) {
                        // configure worker
                        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

                        const url = normalized.pdfPath;
                        let pdfDoc = null;
                        let pageNum = 1;
                        let scale = 1.0;
                        const canvas = document.getElementById('pdf-canvas');
                        const ctx = canvas.getContext('2d');
                        const pageNumElem = document.getElementById('page-num');
                        const pageCountElem = document.getElementById('page-count');

                        async function renderPage(num) {
                            const page = await pdfDoc.getPage(num);
                            const viewport = page.getViewport({ scale: scale });
                            canvas.width = Math.floor(viewport.width);
                            canvas.height = Math.floor(viewport.height);
                            const renderContext = {
                                canvasContext: ctx,
                                viewport: viewport
                            };
                            await page.render(renderContext).promise;
                            pageNumElem.textContent = String(num);
                            const pageInputElem = document.getElementById('page-input');
                            if (pageInputElem) pageInputElem.value = String(num);
                        }

                        async function queueRenderPage(num) {
                            if (!pdfDoc) return;
                            if (num < 1) num = 1;
                            if (num > pdfDoc.numPages) num = pdfDoc.numPages;
                            pageNum = num;
                            await renderPage(pageNum);
                        }

                        // Controls
                        const zoomInBtn = document.getElementById('zoom-in');
                        const zoomOutBtn = document.getElementById('zoom-out');
                        const zoomResetBtn = document.getElementById('zoom-reset');
                        const fitWidthBtn = document.getElementById('fit-width');
                        const pagePrevBtn = document.getElementById('page-prev');
                        const pageNextBtn = document.getElementById('page-next');
                        const pageInput = document.getElementById('page-input');

                        zoomInBtn.addEventListener('click', async () => {
                            scale = +(scale + 0.25).toFixed(2);
                            await queueRenderPage(pageNum);
                        });
                        zoomOutBtn.addEventListener('click', async () => {
                            scale = Math.max(0.25, +(scale - 0.25).toFixed(2));
                            await queueRenderPage(pageNum);
                        });
                        zoomResetBtn.addEventListener('click', async () => {
                            scale = 1.0;
                            await queueRenderPage(pageNum);
                        });
                        fitWidthBtn.addEventListener('click', async () => {
                            // set scale so canvas width equals container width
                            const container = document.getElementById('pdf-container');
                            // guess: render first page at scale 1 to get original width
                            const testPage = await pdfDoc.getPage(pageNum);
                            const viewport1 = testPage.getViewport({ scale: 1.0 });
                            const containerWidth = container.clientWidth - 16; // padding
                            const target = +(containerWidth / viewport1.width).toFixed(2);
                            scale = Math.max(0.25, Math.min(3, target));
                            await queueRenderPage(pageNum);
                        });

                        // page navigation via buttons and input
                        pagePrevBtn.addEventListener('click', () => queueRenderPage(pageNum - 1));
                        pageNextBtn.addEventListener('click', () => queueRenderPage(pageNum + 1));
                        pageInput.addEventListener('change', () => {
                            let val = parseInt(pageInput.value, 10);
                            if (isNaN(val)) val = pageNum;
                            queueRenderPage(val);
                        });

                        // page navigation via keyboard (optional)
                        document.addEventListener('keydown', (e) => {
                            if (e.key === 'ArrowRight') queueRenderPage(pageNum + 1);
                            if (e.key === 'ArrowLeft') queueRenderPage(pageNum - 1);
                        });

                        // Load document
                        try {
                            const loadingTask = pdfjsLib.getDocument(url);
                            pdfDoc = await loadingTask.promise;
                            pageCountElem.textContent = String(pdfDoc.numPages);
                            pageNum = 1;
                            await queueRenderPage(pageNum);
                        } catch (err) {
                            const container = document.getElementById('pdf-container');
                            container.innerHTML = `<div class="p-6 text-center text-red-400">PDF yüklenemedi: ${err.message}</div>`;
                        }
                    }

                    // If the resource is an image, wire up simple zoom/fit controls
                    if (isImage) {
                        const img = document.getElementById('preview-img');
                        let imgScale = 1.0;
                        const minImgScale = 0.25;
                        const maxImgScale = 3;

                        const zoomInBtn = document.getElementById('zoom-in');
                        const zoomOutBtn = document.getElementById('zoom-out');
                        const zoomResetBtn = document.getElementById('zoom-reset');
                        const fitWidthBtn = document.getElementById('fit-width');

                        function applyImgScale() {
                            if (!img) return;
                            // clear any fixed width when using transform scaling
                            img.style.width = '';
                            img.style.transform = `scale(${imgScale})`;
                            img.style.display = 'block';
                        }

                        if (zoomInBtn) zoomInBtn.addEventListener('click', () => {
                            imgScale = Math.min(maxImgScale, +(imgScale + 0.25).toFixed(2));
                            applyImgScale();
                        });
                        if (zoomOutBtn) zoomOutBtn.addEventListener('click', () => {
                            imgScale = Math.max(minImgScale, +(imgScale - 0.25).toFixed(2));
                            applyImgScale();
                        });
                        if (zoomResetBtn) zoomResetBtn.addEventListener('click', () => {
                            imgScale = 1.0;
                            if (img) {
                                img.style.transform = '';
                                img.style.width = '';
                            }
                        });
                        if (fitWidthBtn) fitWidthBtn.addEventListener('click', () => {
                            if (!img) return;
                            img.style.width = '100%';
                            img.style.height = 'auto';
                            imgScale = 1.0;
                            img.style.transform = '';
                        });
                    }
                }

                document.addEventListener('DOMContentLoaded', initDetail);
            </script>
</body>
</html>